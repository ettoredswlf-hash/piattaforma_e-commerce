{% extends "catalog/base.html" %}

{% block title %}Carrello{% endblock %}

{% block content %}
<div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
  <div>
    <h1 class="h1" style="margin-bottom:6px;">Carrello</h1>
    <p class="muted" style="margin-top:0;">Rivedi i prodotti nel carrello e procedi al checkout.</p>
  </div>

  <!-- Bottone torna ai prodotti -->
  <a class="btn" href="{% url 'catalog:product_list' %}">← Continua lo shopping</a>
</div>

<div class="card" style="margin-top:12px;">
  <div style="overflow-x:auto;">
    <table class="table">
      <thead>
        <tr>
          <th>Prodotto</th>
          <th style="width:170px;">Quantità</th>
          <th style="width:140px;">Prezzo unità</th>
          <th style="width:140px;">Prezzo totale</th>
          <th style="width:120px;">Azioni</th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart %}
          {% with product=item.product %}
          <tr>
            <td>
              <!-- Facoltativo: link al dettaglio prodotto -->
              <a class="muted" style="text-decoration:none;" href="{% url 'catalog:product_detail' product.pk %}">
                {{ product.name }}
              </a>
            </td>

            <!-- Quantità: layout con - e + -->
            <td>
              <div class="qty-box">
                <a class="btn btn-qty" href="{% url 'shopping_cart:decrease' product.id %}">−</a>
                <span class="qty-num">{{ item.qty }}</span>
                <a class="btn btn-qty" href="{% url 'shopping_cart:increase' product.id %}">+</a>
              </div>
            </td>

            <td>€{{ item.price }}</td>
            <td>€{{ item.total_price }}</td>

            <td>
              <a class="btn btn-danger" href="{% url 'shopping_cart:cart_remove' product.id %}">Rimuovi</a>
            </td>
          </tr>
          {% endwith %}
        {% empty %}
          <tr>
            <td colspan="5" class="muted">Il carrello è vuoto.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-top:14px;">
    <div style="font-weight:800; font-size:18px;">Totale: €{{ cart.get_total_price }}</div>

    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a class="btn" href="{% url 'catalog:product_list' %}">Aggiungi altri prodotti</a>
      <a class="btn btn-primary" href="{% url 'orders:order_create' %}">Procedi al checkout</a>
    </div>
  </div>
</div>
{% endblock %}
