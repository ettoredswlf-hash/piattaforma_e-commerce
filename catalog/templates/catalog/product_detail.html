{% extends "catalog/base.html" %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<a class="muted" href="{% url 'catalog:product_list' %}">← Torna ai prodotti</a>

<div class="card" style="margin-top:12px;">
  <div style="display:grid; grid-template-columns: 1.2fr 1fr; gap:16px; align-items:start;">

    <!-- COLONNA IMMAGINI -->
    <div>

      {% if product.image %}
        <div class="product-image-box">
          <img
            id="mainProductImage"
            class="product-detail-img"
            src="{{ product.image.url }}"
            alt="{{ product.name }}"
          >
        </div>
      {% else %}
        <div class="product-image-box product-image-placeholder" style="height:380px;">
          <span class="muted">Nessuna immagine</span>
        </div>
      {% endif %}

      <!-- Thumbnails -->
      <div class="product-thumbs-row">
        {% if product.image %}
          <img class="product-thumb is-active" src="{{ product.image.url }}" alt="{{ product.name }} - 1">
        {% endif %}
        {% if product.image_2 %}
          <img class="product-thumb" src="{{ product.image_2.url }}" alt="{{ product.name }} - 2">
        {% endif %}
        {% if product.image_3 %}
          <img class="product-thumb" src="{{ product.image_3.url }}" alt="{{ product.name }} - 3">
        {% endif %}
      </div>
    </div>

    <!-- COLONNA INFO -->
    <div>
      <h1 class="h1" style="margin-top:0;">{{ product.name }}</h1>
      <div class="price" style="font-size:22px;">€{{ product.price }}</div>

      {% if product.description %}
        <p class="muted" style="margin-top:12px; line-height:1.6;">
          {{ product.description }}
        </p>
      {% else %}
        <p class="muted" style="margin-top:12px;">Nessuna descrizione.</p>
      {% endif %}

      <div style="display:flex; gap:10px; margin-top:16px; flex-wrap:wrap;">
        <a class="btn btn-primary" href="{% url 'shopping_cart:cart_add' product.id %}">Aggiungi al carrello</a>
        <a class="btn" href="/cart/">Vai al carrello</a>
      </div>

      <div class="muted" style="margin-top:14px; font-size:12px;">
        Disponibilità: {% if product.available %}Disponibile{% else %}Non disponibile{% endif %}
      </div>
    </div>

  </div>
</div>

<script>
  (function () {
    const main = document.getElementById("mainProductImage");
    if (!main) return;

    const thumbs = document.querySelectorAll(".product-thumb");
    if (!thumbs.length) return;

    thumbs.forEach((t) => {
      t.addEventListener("click", () => {
        // aggiorna immagine principale
        main.src = t.src;

        // evidenzia thumbnail selezionata
        thumbs.forEach(x => x.classList.remove("is-active"));
        t.classList.add("is-active");
      });
    });
  })();
</script>
{% endblock %}
